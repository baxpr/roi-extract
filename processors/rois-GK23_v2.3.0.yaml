---
procyamlversion: 3.0.0-dev.0

containers:
  - name: fsl
    path: fsl-base_v6.0.7.18.sif
    source: docker://baxterprogers/fsl-base:v6.0.7.18
    
requirements:
  walltime: 0-12
  memory: 8000

jobtemplate: job_template_v3.txt

inputs:
  xnat:

    assessors:
        
        - name: assr_ert
          proctypes: fmri-ert_v2
          resources:
            - {resource: spm_ert, ftype: DIR}

    attrs:
      - {varname: project, object: assessor, attr: project}
      - {varname: subject, object: session, attr: subject_label}
      - {varname: session, object: session, attr: label}
     
outputs:
  - {path: roi-extract.pdf, type: FILE, resource: PDF}
  - {path: ROIS, type: DIR, resource: ROIS}
  - {path: roidata.csv, type: FILE, resource: STATS}
  - {path: roi-extract/src, type: DIR, resource: SCRIPTS}

      
command: 
  type: singularity_exec
  container: fsl
  args: >-
    bash -c '
    cd /OUTPUTS &&
    wget https://github.com/baxpr/roi-extract/archive/refs/tags/v2.3.0.tar.gz &&
    tar -zxf v*.tar.gz &&
    mv roi-extract-* roi-extract &&
    export PATH=/OUTPUTS/roi-extract/src:\$PATH &&
    xwrapper.sh generic-extract.sh
      --roi_niigz atlas-NegVal15_space-MNI152NLin6Asym_dseg.nii.gz
      --underlay_niigz /INPUTS/spm_ert/spm_ert/beta_0098.nii.gz
      --mask_niigz /INPUTS/spm_ert/spm_ert/mask.nii.gz
      --tgts_niigz
        /INPUTS/spm_ert/spm_ert/con_0001.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0002.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0003.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0004.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0005.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0006.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0007.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0008.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0009.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0010.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0011.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0012.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0013.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0014.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0015.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0016.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0017.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0018.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0019.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0020.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0021.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0022.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0023.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0024.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0025.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0026.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0027.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0028.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0029.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0030.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0031.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0032.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0033.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0034.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0035.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0036.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0037.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0038.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0039.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0040.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0041.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0042.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0043.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0044.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0045.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0046.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0047.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0048.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0049.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0050.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0051.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0052.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0053.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0054.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0055.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0056.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0057.nii.gz
        /INPUTS/spm_ert/spm_ert/con_0058.nii.gz
      --out_dir ../OUTPUTS
    '
